@{
    ViewData["Title"] = "Financial Management";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>@ViewData["Title"] - SHNgms</title>
    <link rel="stylesheet" href="~/css/style.css">
</head>
<body>

    <header>
        <h1>Financial Management</h1>
        <nav>
            <ul>
                <li><a href="@Url.Action("Index", "Dashboard")">Dashboard</a></li>
                <li><a href="@Url.Action("Index", "GrantManagement")">Grant Management</a></li>
                <!-- Add other navigation links here -->
            </ul>
        </nav>
    </header>

    <main>
        <section id="fund-distribution">
            <h2>Fund Distribution</h2>
            <table>
                <thead>
                    <tr>
                        <th>Grant Title</th>
                        <th>Allocated Funds</th>
                        <th>Spent</th>
                        <th>Remaining</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dynamic data will be populated here -->
                </tbody>
            </table>
        </section>

        <section id="expense-tracking">
            <h2>Expense Tracking</h2>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Expense Description</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dynamic data will be populated here -->
                </tbody>
            </table>
        </section>

        <section id="budget-monitoring">
            <h2>Budget Monitoring</h2>
            <div class="budget-chart"></div>
            <!-- Placeholder for charts or budget analysis tools -->
        </section>

        <section id="add-expense">
            <h2>Add New Expense</h2>
            <form id="expense-form">
                <label for="expense-date">Date:</label>
                <input type="date" id="expense-date" name="expense-date" required>
                
                <label for="expense-description">Description:</label>
                <input type="text" id="expense-description" name="expense-description" required>

                <label for="expense-amount">Amount:</label>
                <input type="number" id="expense-amount" name="expense-amount" required>

                <button type="submit">Add Expense</button>
            </form>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Second Harvest Northland</p>
    </footer>

    <script>
        async function fetchFundDistribution() {
            const response = await fetch('@Url.Action("GetFundDistribution", "FinancialManagement")');
            const fundData = await response.json();
            const fundTableBody = document.querySelector('#fund-distribution tbody');

            fundData.forEach(fund => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${fund.grantTitle}</td>
                    <td>${fund.allocatedFunds}</td>
                    <td>${fund.spent}</td>
                    <td>${fund.remaining}</td>
                `;
                fundTableBody.appendChild(row);
            });
        }

        async function fetchExpenseTracking() {
            const response = await fetch('@Url.Action("GetExpenses", "FinancialManagement")');
            const expenses = await response.json();
            const expenseTableBody = document.querySelector('#expense-tracking tbody');

            expenses.forEach(expense => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(expense.date).toLocaleDateString()}</td>
                    <td>${expense.description}</td>
                    <td>${expense.amount}</td>
                `;
                expenseTableBody.appendChild(row);
            });
        }

        document.getElementById('expense-form').addEventListener('submit', async (event) => {
            event.preventDefault();

            const date = document.getElementById('expense-date').value;
            const description = document.getElementById('expense-description').value;
            const amount = document.getElementById('expense-amount').value;

            const response = await fetch('@Url.Action("AddExpense", "FinancialManagement")', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ date, description, amount })
            });

            if (response.ok) {
                fetchExpenseTracking(); // Refresh the expense tracking table
                alert('Expense added successfully!');
            } else {
                alert('Failed to add expense.');
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            fetchFundDistribution();
            fetchExpenseTracking();
        });
    </script>

</body>
</html>
